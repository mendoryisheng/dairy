
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å¤šå°ºåº¦ç§å…»ç»“åˆçš„ç‰©èƒ½å¾ªç¯ä¸åŸ¹è‚¥å¢äº§å†³ç­–æ”¯æŒç³»ç»Ÿ">
    <meta name="keywords" content="ç§å…»ç»“åˆ,ç‰©èƒ½å¾ªç¯,åŸ¹è‚¥å¢äº§,å¥¶ç‰›å…»æ®–,æ¸©å®¤æ°”ä½“æ’æ”¾,å…»åˆ†å¾ªç¯">
    <meta name="author" content="Angela Bryant">
    <title>å¤šå°ºåº¦ç§å…»ç»“åˆçš„ç‰©èƒ½å¾ªç¯ä¸åŸ¹è‚¥å¢äº§å†³ç­–ç³»ç»Ÿ</title>
    
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ„</text></svg>">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft YaHei', 'PingFang SC', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .header p {
            color: #7f8c8d;
            font-size: 14px;
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 380px 1fr;
            gap: 20px;
        }
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
            display: flex;
            align-items: center;
        }
        
        .card-title span {
            margin-right: 10px;
            font-size: 22px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #34495e;
            margin-bottom: 8px;
        }
        
        .form-input,
        .form-select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .form-input:focus,
        .form-select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .slider-container {
            margin-top: 8px;
        }
        
        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            border: none;
        }
        
        .slider-label {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            padding: 20px;
            color: white;
            text-align: center;
        }
        
        .metric-card.red {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .metric-card.yellow {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        
        .metric-card.green {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }
        
        .metric-card.blue {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .metric-card.orange {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }
        
        .metric-label {
            font-size: 13px;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .metric-unit {
            font-size: 12px;
            opacity: 0.8;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .chart-grid {
                grid-template-columns: 1fr;
            }
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        table thead {
            background: #f8f9fa;
        }
        
        table th {
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: #2c3e50;
            border-bottom: 2px solid #e0e0e0;
        }
        
        table td {
            padding: 12px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        table tr.section-header {
            background: #f0f4ff;
            font-weight: 600;
        }
        
        table tr:hover {
            background: #f8f9fa;
        }
        
        .bar-chart {
            display: flex;
            align-items: flex-end;
            height: 250px;
            padding: 20px 0;
            gap: 15px;
        }
        
        .bar-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }
        
        .bar {
            width: 100%;
            background: linear-gradient(to top, #667eea, #764ba2);
            border-radius: 8px 8px 0 0;
            position: relative;
            transition: all 0.3s;
        }
        
        .bar:hover {
            opacity: 0.8;
        }
        
        .bar-value {
            position: absolute;
            top: -25px;
            width: 100%;
            text-align: center;
            font-size: 13px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .bar-label {
            font-size: 13px;
            color: #7f8c8d;
            text-align: center;
        }
        
        .pie-chart {
            display: flex;
            align-items: center;
            gap: 30px;
            padding: 20px;
        }
        
        .pie-visual {
            position: relative;
            width: 200px;
            height: 200px;
        }
        
        .pie-legend {
            flex: 1;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            margin-right: 10px;
        }
        
        .legend-text {
            font-size: 14px;
            color: #2c3e50;
        }
        
        .scatter-chart {
            position: relative;
            height: 300px;
            padding: 30px 40px 40px 60px;
        }
        
        .scatter-canvas {
            width: 100%;
            height: 100%;
            border-left: 2px solid #ddd;
            border-bottom: 2px solid #ddd;
            position: relative;
        }
        
        .scatter-point {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            opacity: 0.6;
            transition: all 0.3s;
        }
        
        .scatter-point:hover {
            opacity: 1;
            transform: scale(1.5);
        }
        
        .axis-label {
            position: absolute;
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .x-axis-label {
            bottom: 5px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .y-axis-label {
            left: 5px;
            top: 50%;
            transform: translateY(-50%) rotate(-90deg);
        }
        
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .info-box h4 {
            color: #1976d2;
            margin-bottom: 10px;
        }
        
        .info-box ul {
            list-style: none;
            padding-left: 0;
        }
        
        .info-box li {
            color: #0d47a1;
            margin-bottom: 8px;
            padding-left: 20px;
            position: relative;
        }
        
        .info-box li:before {
            content: "â€¢";
            position: absolute;
            left: 5px;
            font-weight: bold;
        }
        
        .footer {
            text-align: center;
            padding: 20px;
            margin-top: 30px;
            color: white;
            font-size: 14px;
            opacity: 0.9;
        }
        
        .flow-chart {
            padding: 20px;
            position: relative;
        }
        
        .flow-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .flow-box {
            flex: 1;
            padding: 15px;
            border-radius: 8px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            font-weight: bold;
        }
        
        .flow-arrow {
            padding: 0 15px;
            font-size: 24px;
            color: #667eea;
        }
        
        .comparison-chart {
            padding: 20px;
        }
        
        .comparison-row {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 15px;
        }
        
        .comparison-label {
            width: 120px;
            font-size: 14px;
            color: #2c3e50;
            font-weight: 600;
        }
        
        .comparison-bar-container {
            flex: 1;
            height: 30px;
            background: #f0f0f0;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }
        
        .comparison-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 10px;
            color: white;
            font-size: 12px;
            font-weight: bold;
            transition: width 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- æ ‡é¢˜ -->
        <div class="header">
            <h1>ğŸ„ å¤šå°ºåº¦ç§å…»ç»“åˆçš„ç‰©èƒ½å¾ªç¯ä¸åŸ¹è‚¥å¢äº§å†³ç­–ç³»ç»Ÿ</h1>
            <p>åŸºäºCLEANERæ¨¡å‹çš„å…¨é“¾æ¡æ¸©å®¤æ°”ä½“æ’æ”¾ä¸å…»åˆ†æµåŠ¨åˆ†æå¹³å°</p>
        </div>

        <div class="main-grid">
            <!-- å·¦ä¾§ï¼šè¾“å…¥å‚æ•° -->
            <div>
                <!-- åŸºç¡€ä¿¡æ¯ -->
                <div class="card">
                    <div class="card-title">
                        <span>ğŸ“Š</span>åŸºç¡€ä¿¡æ¯
                    </div>
                    <div class="form-group">
                        <label class="form-label">å¥¶ç‰›æ•°é‡ï¼ˆå¤´ï¼‰</label>
                        <input type="number" id="cattleNumber" class="form-input" value="100" min="1" max="10000" onchange="calculate()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">å…»æ®–è§„æ¨¡</label>
                        <select id="farmScale" class="form-select" onchange="calculate()">
                            <option value="small">å°è§„æ¨¡ (&lt;50å¤´)</option>
                            <option value="medium" selected>ä¸­è§„æ¨¡ (50-200å¤´)</option>
                            <option value="large">å¤§è§„æ¨¡ (&gt;200å¤´)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ°”å€™åŒº</label>
                        <select id="climateZone" class="form-select" onchange="calculate()">
                            <option value="cool">å¯’å†· (&lt;15Â°C)</option>
                            <option value="temperate" selected>æ¸©å¸¦ (15-25Â°C)</option>
                            <option value="warm">æ¸©æš– (&gt;25Â°C)</option>
                        </select>
                    </div>
                </div>

                <!-- æ—¥ç²®é…æ–¹ -->
                <div class="card">
                    <div class="card-title">
                        <span>ğŸŒ¾</span>æ—¥ç²®é…æ–¹
                    </div>
                    <div class="form-group">
                        <label class="form-label">ç²—è›‹ç™½å«é‡ï¼š<span id="cpValue">16.0</span>%</label>
                        <div class="slider-container">
                            <input type="range" id="crudeProtein" class="slider" min="12" max="20" step="0.5" value="16" oninput="updateSlider('cp'); calculate()">
                            <div class="slider-label">
                                <span>12%</span>
                                <span>20%</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">é¥²æ–™èƒ½é‡ï¼š<span id="energyValue">180</span> MJ/å¤©</label>
                        <div class="slider-container">
                            <input type="range" id="feedEnergy" class="slider" min="150" max="220" step="5" value="180" oninput="updateSlider('energy'); calculate()">
                            <div class="slider-label">
                                <span>150 MJ</span>
                                <span>220 MJ</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">ç²¾æ–™æ¯”ä¾‹ï¼š<span id="concentrateValue">50</span>%</label>
                        <div class="slider-container">
                            <input type="range" id="concentrateRatio" class="slider" min="30" max="70" step="5" value="50" oninput="updateSlider('concentrate'); calculate()">
                            <div class="slider-label">
                                <span>30%</span>
                                <span>70%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- åœˆèˆç®¡ç† -->
                <div class="card">
                    <div class="card-title">
                        <span>ğŸ </span>åœˆèˆç®¡ç†
                    </div>
                    <div class="form-group">
                        <label class="form-label">åœ°æ¿ç±»å‹</label>
                        <select id="floorType" class="form-select" onchange="calculate()">
                            <option value="solid" selected>å®å¿ƒåœ°æ¿</option>
                            <option value="slatted">æ¼ç¼åœ°æ¿</option>
                            <option value="litter">å«æ–™ç³»ç»Ÿ</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">æ¸…ç²ªæ–¹å¼</label>
                        <select id="manureSystem" class="form-select" onchange="calculate()">
                            <option value="manual">äººå·¥æ¸…ç†</option>
                            <option value="scraper" selected>æœºæ¢°åˆ®ç²ª</option>
                            <option value="flush">æ°´å†²æ´—</option>
                        </select>
                    </div>
                </div>

                <!-- ç²ªæ±¡å¤„ç† -->
                <div class="card">
                    <div class="card-title">
                        <span>â™»ï¸</span>ç²ªæ±¡å¤„ç†
                    </div>
                    <div class="form-group">
                        <label class="form-label">å‚¨å­˜æ–¹å¼</label>
                        <select id="storageType" class="form-select" onchange="calculate()">
                            <option value="liquid" selected>æ¶²æ€å‚¨å­˜</option>
                            <option value="solid">å›ºæ€å‚¨å­˜</option>
                            <option value="covered">è¦†ç›–å‚¨å­˜</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">å¤„ç†æŠ€æœ¯</label>
                        <select id="treatmentMethod" class="form-select" onchange="calculate()">
                            <option value="storage" selected>å¸¸è§„å‚¨å­˜</option>
                            <option value="anaerobic">åŒæ°§å‘é…µ</option>
                            <option value="compost">å †è‚¥å¤„ç†</option>
                            <option value="direct">ç›´æ¥è¿˜ç”°</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- å³ä¾§ï¼šç»“æœå±•ç¤º -->
            <div>
                <!-- å…³é”®æŒ‡æ ‡ -->
                <div class="metrics-grid">
                    <div class="metric-card red">
                        <div class="metric-label">æ€»CHâ‚„æ’æ”¾</div>
                        <div class="metric-value" id="totalCH4">0.0</div>
                        <div class="metric-unit">å¨/å¹´</div>
                    </div>
                    <div class="metric-card yellow">
                        <div class="metric-label">æ€»NHâ‚ƒæ’æ”¾</div>
                        <div class="metric-value" id="totalNH3">0.00</div>
                        <div class="metric-unit">å¨/å¹´</div>
                    </div>
                    <div class="metric-card blue">
                        <div class="metric-label">æ°®åˆ©ç”¨æ•ˆç‡</div>
                        <div class="metric-value" id="NUE">0.0</div>
                        <div class="metric-unit">%</div>
                    </div>
                    <div class="metric-card green">
                        <div class="metric-label">ç£·åˆ©ç”¨æ•ˆç‡</div>
                        <div class="metric-value" id="PUE">0.0</div>
                        <div class="metric-unit">%</div>
                    </div>
                    <div class="metric-card orange">
                        <div class="metric-label">æ€»Nâ‚‚Oæ’æ”¾</div>
                        <div class="metric-value" id="totalN2O">0.0</div>
                        <div class="metric-unit">kg/å¹´</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">å¯è¿˜ç”°æ°®</div>
                        <div class="metric-value" id="nFieldShort">0</div>
                        <div class="metric-unit">kg N/å¹´</div>
                    </div>
                </div>

                <!-- å›¾è¡¨ç½‘æ ¼ -->
                <div class="chart-grid">
                    <!-- CH4æ’æ”¾é˜¶æ®µå æ¯” -->
                    <div class="card">
                        <div class="card-title">ğŸ“Š CHâ‚„æ’æ”¾å„é˜¶æ®µå æ¯”</div>
                        <div class="pie-chart">
                            <div class="pie-visual">
                                <canvas id="pieCanvas" width="200" height="200"></canvas>
                            </div>
                            <div class="pie-legend">
                                <div class="legend-item">
                                    <div class="legend-color" style="background: #FF6B6B;"></div>
                                    <div class="legend-text">è‚ é“å‘é…µ <span id="entericPercent">0</span>%</div>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background: #4ECDC4;"></div>
                                    <div class="legend-text">åœˆèˆé˜¶æ®µ <span id="housingPercent">0</span>%</div>
                                </div>
                                <div class="legend-item">
                                    <div class="legend-color" style="background: #45B7D1;"></div>
                                    <div class="legend-text">ç²ªæ±¡ç®¡ç† <span id="storagePercent">0</span>%</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- æ°”ä½“æ’æ”¾å¯¹æ¯” -->
                    <div class="card">
                        <div class="card-title">ğŸ“Š å„ç±»æ°”ä½“æ’æ”¾é‡å¯¹æ¯”</div>
                        <div class="bar-chart" id="gasBarChart">
                            <!-- åŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- å…»åˆ†æµåŠ¨åˆ†æ -->
                <div class="card">
                    <div class="card-title">ğŸ”„ å…»åˆ†æµåŠ¨ä¸è½¬åŒ–æ•ˆç‡</div>
                    <div class="flow-chart">
                        <div class="flow-item">
                            <div class="flow-box" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                é¥²æ–™å…»åˆ†æ‘„å…¥<br>
                                <span id="nIntakeFlow">0</span> kg N | <span id="pIntakeFlow">0</span> kg P
                            </div>
                            <div class="flow-arrow">â†’</div>
                            <div class="flow-box" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                äº§å“ç•™å­˜<br>
                                <span id="nProductFlow">0</span> kg N | <span id="pProductFlow">0</span> kg P
                            </div>
                        </div>
                        <div class="flow-item">
                            <div class="flow-box" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);">
                                ç²ªå°¿æ’æ³„<br>
                                <span id="nExcretionFlow">0</span> kg N | <span id="pExcretionFlow">0</span> kg P
                            </div>
                            <div class="flow-arrow">â†’</div>
                            <div class="flow-box" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);">
                                æ°”æ€æŸå¤±<br>
                                <span id="nLossFlow">0</span> kg N
                            </div>
                        </div>
                        <div class="flow-item">
                            <div class="flow-box" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);">
                                å¯è¿˜ç”°å…»åˆ†<br>
                                <span id="nFieldFlow">0</span> kg N | <span id="pFieldFlow">0</span> kg P
                            </div>
                            <div class="flow-arrow">â†’</div>
                            <div class="flow-box" style="background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);">
                                æ›¿ä»£åŒ–è‚¥<br>
                                <span id="fertilizerSaved">0</span> kg
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å‡æ’æ½œåŠ›å¯¹æ¯” -->
                <div class="card">
                    <div class="card-title">âš¡ ä¸åŒå¤„ç†æ–¹å¼å‡æ’æ½œåŠ›å¯¹æ¯”</div>
                    <div class="comparison-chart" id="comparisonChart">
                        <!-- åŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>

                <!-- ç¯å¢ƒå½±å“è¯„ä¼° -->
                <div class="card">
                    <div class="card-title">ğŸŒ ç¯å¢ƒå½±å“ç»¼åˆè¯„ä¼°</div>
                    <div class="scatter-chart">
                        <div class="scatter-canvas" id="scatterCanvas">
                            <div class="axis-label x-axis-label">æ°®åˆ©ç”¨æ•ˆç‡ (%)</div>
                            <div class="axis-label y-axis-label">CHâ‚„æ’æ”¾å¼ºåº¦ (kg/kgäº§å“)</div>
                        </div>
                    </div>
                </div>

                <!-- è¯¦ç»†æ•°æ®è¡¨æ ¼ -->
                <div class="card">
                    <div class="card-title">ğŸ“‹ æ’æ”¾ä¸å…»åˆ†è¯¦æƒ…</div>
                    <table>
                        <thead>
                            <tr>
                                <th>æŒ‡æ ‡ç±»åˆ«</th>
                                <th style="text-align: right;">æ•°å€¼</th>
                                <th>å•ä½</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="section-header">
                                <td colspan="3">å…»åˆ†æ’æ³„é‡</td>
                            </tr>
                            <tr>
                                <td>æ°®æ’æ³„é‡</td>
                                <td style="text-align: right;" id="nExcretion">0</td>
                                <td>kg N/å¹´</td>
                            </tr>
                            <tr>
                                <td>ç£·æ’æ³„é‡</td>
                                <td style="text-align: right;" id="pExcretion">0</td>
                                <td>kg P/å¹´</td>
                            </tr>
                            <tr class="section-header">
                                <td colspan="3">æ¸©å®¤æ°”ä½“æ’æ”¾</td>
                            </tr>
                            <tr>
                                <td>è‚ é“å‘é…µCHâ‚„</td>
                                <td style="text-align: right;" id="ch4Enteric">0</td>
                                <td>kg/å¹´</td>
                            </tr>
                            <tr>
                                <td>åœˆèˆé˜¶æ®µCHâ‚„</td>
                                <td style="text-align: right;" id="ch4Housing">0</td>
                                <td>kg/å¹´</td>
                            </tr>
                            <tr>
                                <td>ç²ªæ±¡ç®¡ç†CHâ‚„</td>
                                <td style="text-align: right;" id="ch4Storage">0</td>
                                <td>kg/å¹´</td>
                            </tr>
                            <tr>
                                <td>NHâ‚ƒæ’æ”¾</td>
                                <td style="text-align: right;" id="nh3Emission">0</td>
                                <td>kg/å¹´</td>
                            </tr>
                            <tr>
                                <td>Nâ‚‚Oæ’æ”¾</td>
                                <td style="text-align: right;" id="n2oEmission">0</td>
                                <td>kg/å¹´</td>
                            </tr>
                            <tr class="section-header">
                                <td colspan="3">å¯è¿˜ç”°å…»åˆ†</td>
                            </tr>
                            <tr>
                                <td>å¯è¿˜ç”°æ°®é‡</td>
                                <td style="text-align: right;" id="nField">0</td>
                                <td>kg N/å¹´</td>
                            </tr>
                            <tr>
                                <td>å¯è¿˜ç”°ç£·é‡</td>
                                <td style="text-align: right;" id="pField">0</td>
                                <td>kg P/å¹´</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- è¯´æ˜ä¿¡æ¯ -->
                <div class="info-box">
                    <h4>â„¹ï¸ ç³»ç»Ÿè¯´æ˜</h4>
                    <ul>
                        <li>æœ¬ç³»ç»ŸåŸºäºCLEANERæ¨¡å‹å’ŒIPCC Tier 2æ–¹æ³•å­¦æ„å»º</li>
                        <li>å®ç°å¤šå°ºåº¦ç§å…»ç»“åˆçš„ç‰©è´¨èƒ½é‡å¾ªç¯å…¨è¿‡ç¨‹æ¨¡æ‹Ÿ</li>
                        <li>æ’æ”¾è®¡ç®—æ¶µç›–è‚ é“å‘é…µã€åœˆèˆã€å‚¨å­˜ã€å¤„ç†å…¨é“¾æ¡</li>
                        <li>å…»åˆ†åˆ©ç”¨æ•ˆç‡åæ˜ äº†åŠ¨ç‰©å°†é¥²æ–™å…»åˆ†è½¬åŒ–ä¸ºäº§å“çš„èƒ½åŠ›</li>
                        <li>å¯é€šè¿‡ä¼˜åŒ–æ—¥ç²®é…æ–¹ã€æ”¹è¿›åœˆèˆç®¡ç†å’Œé‡‡ç”¨å‡æ’æŠ€æœ¯é™ä½æ’æ”¾</li>
                        <li>ç³»ç»Ÿæ”¯æŒåŸ¹è‚¥å¢äº§å†³ç­–ï¼Œè¯„ä¼°ç²ªè‚¥è¿˜ç”°æ›¿ä»£åŒ–è‚¥çš„æ½œåŠ›</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- é¡µè„š -->
        <div class="footer">
            Â© 2024 å¤šå°ºåº¦ç§å…»ç»“åˆçš„ç‰©èƒ½å¾ªç¯ä¸åŸ¹è‚¥å¢äº§å†³ç­–ç³»ç»Ÿ | åŸºäºCLEANERæ¨¡å‹
        </div>
    </div>

    <script>
        // æ’æ”¾å› å­å‚æ•°
        const params = {
            entericYm: {
                low: 5.5,
                medium: 6.5,
                high: 7.0
            },
            housingEF: {
                solid: { NH3: 15, N2O: 0.5, CH4_VS: 3 },
                slatted: { NH3: 18, N2O: 0.3, CH4_VS: 4 },
                litter: { NH3: 12, N2O: 0.8, CH4_VS: 5 }
            },
            MCF: {
                liquid: { cool: 10, temperate: 17, warm: 27 },
                solid: { cool: 1, temperate: 2, warm: 4 },
                covered: { cool: 8, temperate: 14, warm: 22 }
            },
            treatmentReduction: {
                storage: { CH4: 0, NH3: 0, N2O: 0 },
                anaerobic: { CH4: -20, NH3: 50, N2O: 30 },
                compost: { CH4: 80, NH3: 30, N2O: 20 },
                direct: { CH4: 95, NH3: 60, N2O: 50 }
            }
        };

        // æ›´æ–°æ»‘å—æ˜¾ç¤º
        function updateSlider(type) {
            if (type === 'cp') {
                document.getElementById('cpValue').textContent = document.getElementById('crudeProtein').value;
            } else if (type === 'energy') {
                document.getElementById('energyValue').textContent = document.getElementById('feedEnergy').value;
            } else if (type === 'concentrate') {
                document.getElementById('concentrateValue').textContent = document.getElementById('concentrateRatio').value;
            }
        }

        // æ ¸å¿ƒè®¡ç®—å‡½æ•°
        function calculate() {
            const cattleNumber = parseFloat(document.getElementById('cattleNumber').value);
            const climateZone = document.getElementById('climateZone').value;
            const crudeProtein = parseFloat(document.getElementById('crudeProtein').value);
            const feedEnergy = parseFloat(document.getElementById('feedEnergy').value);
            const floorType = document.getElementById('floorType').value;
            const storageType = document.getElementById('storageType').value;
            const treatmentMethod = document.getElementById('treatmentMethod').value;

            // 1. å…»åˆ†æ‘„å…¥å’Œæ’æ³„
            const dryMatterIntake = 20;
            const nIntake = (dryMatterIntake * crudeProtein / 100) / 6.25;
            const pIntake = dryMatterIntake * 0.45 / 100;
            
            const milkYield = 25;
            const milkN = milkYield * 0.53 / 100;
            const milkP = milkYield * 0.095 / 100;
            
            const nExcretion = nIntake - milkN;
            const pExcretion = pIntake - milkP;
            
            const NUE = (milkN / nIntake) * 100;
            const PUE = (milkP / pIntake) * 100;
            
            // 2. è‚ é“å‘é…µCH4
            const ymValue = crudeProtein < 15 ? params.entericYm.low : 
                           crudeProtein < 18 ? params.entericYm.medium : params.entericYm.high;
            const GE = feedEnergy / 0.65;
            const entericCH4 = (GE * ymValue / 100) / 55.65;
            
            // 3. VSæ’æ³„å’Œåœˆèˆæ’æ”¾
            const vsExcretion = dryMatterIntake * 0.8 * 0.85;
            const housingNH3 = nExcretion * params.housingEF[floorType].NH3 / 100;
            const housingN2O = nExcretion * params.housingEF[floorType].N2O / 100;
            const housingCH4_VS = vsExcretion * params.housingEF[floorType].CH4_VS / 100;
            
            // 4. å‚¨å­˜/å¤„ç†é˜¶æ®µæ’æ”¾
            const B0 = 0.24;
            const mcfValue = params.MCF[storageType][climateZone];
            const storageCH4_base = vsExcretion * B0 * 0.67 * (mcfValue / 100);
            
            const reductionFactor = params.treatmentReduction[treatmentMethod];
            const storageCH4 = storageCH4_base * (1 + reductionFactor.CH4 / 100);
            const storageNH3 = (nExcretion - housingNH3) * 0.25 * (1 - reductionFactor.NH3 / 100);
            const storageN2O = (nExcretion - housingNH3) * 0.005 * (1 - reductionFactor.N2O / 100);
            
            // 5. å¹´åŒ–å¹¶ä¹˜ä»¥ç‰›å¤´æ•°
            const totalEntericCH4 = entericCH4 * 365 * cattleNumber;
            const totalHousingCH4 = housingCH4_VS * 365 * cattleNumber;
            const totalStorageCH4 = storageCH4 * 365 * cattleNumber;
            const totalCH4 = totalEntericCH4 + totalHousingCH4 + totalStorageCH4;
            
            const totalNH3 = (housingNH3 + storageNH3) * 365 * cattleNumber;
            const totalN2O = (housingN2O + storageN2O) * 365 * cattleNumber;
            
            const nRemaining = (nExcretion - housingNH3 - storageNH3) * 365 * cattleNumber;
            const pRemaining = pExcretion * 365 * cattleNumber * 0.95;
            
            const totalNExcretion = nExcretion * 365 * cattleNumber;
            const totalPExcretion = pExcretion * 365 * cattleNumber;
            
            const totalNIntake = nIntake * 365 * cattleNumber;
            const totalPIntake = pIntake * 365 * cattleNumber;
            const totalNProduct = milkN * 365 * cattleNumber;
            const totalPProduct = milkP * 365 * cattleNumber;
            const totalNLoss = totalNH3 + totalN2O;
            const fertilizerSaved = nRemaining * 3;  // å‡è®¾1kg Nç²ªè‚¥çº¦ç­‰äº3kgåŒ–è‚¥

            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('totalCH4').textContent = (totalCH4 / 1000).toFixed(1);
            document.getElementById('totalNH3').textContent = (totalNH3 / 1000).toFixed(2);
            document.getElementById('NUE').textContent = NUE.toFixed(1);
            document.getElementById('PUE').textContent = PUE.toFixed(1);
            document.getElementById('totalN2O').textContent = totalN2O.toFixed(0);
            document.getElementById('nFieldShort').textContent = nRemaining.toFixed(0);
            
            document.getElementById('nExcretion').textContent = totalNExcretion.toFixed(0);
            document.getElementById('pExcretion').textContent = totalPExcretion.toFixed(0);
            document.getElementById('ch4Enteric').textContent = totalEntericCH4.toFixed(0);
            document.getElementById('ch4Housing').textContent = totalHousingCH4.toFixed(0);
            document.getElementById('ch4Storage').textContent = totalStorageCH4.toFixed(0);
            document.getElementById('nh3Emission').textContent = totalNH3.toFixed(0);
            document.getElementById('n2oEmission').textContent = totalN2O.toFixed(0);
            document.getElementById('nField').textContent = nRemaining.toFixed(0);
            document.getElementById('pField').textContent = pRemaining.toFixed(0);
            
            // æ›´æ–°å…»åˆ†æµåŠ¨
            document.getElementById('nIntakeFlow').textContent = totalNIntake.toFixed(0);
            document.getElementById('pIntakeFlow').textContent = totalPIntake.toFixed(0);
            document.getElementById('nProductFlow').textContent = totalNProduct.toFixed(0);
            document.getElementById('pProductFlow').textContent = totalPProduct.toFixed(0);
            document.getElementById('nExcretionFlow').textContent = totalNExcretion.toFixed(0);
            document.getElementById('pExcretionFlow').textContent = totalPExcretion.toFixed(0);
            document.getElementById('nLossFlow').textContent = totalNLoss.toFixed(0);
            document.getElementById('nFieldFlow').textContent = nRemaining.toFixed(0);
            document.getElementById('pFieldFlow').textContent = pRemaining.toFixed(0);
            document.getElementById('fertilizerSaved').textContent = fertilizerSaved.toFixed(0);

            // æ›´æ–°å›¾è¡¨
            drawPieChart(totalEntericCH4, totalHousingCH4, totalStorageCH4);
            drawBarChart(totalCH4, totalNH3, totalN2O);
            drawComparisonChart(totalCH4);
            drawScatterChart(NUE, totalCH4 / (milkYield * 365 * cattleNumber));
        }

        // ç»˜åˆ¶é¥¼å›¾
        function drawPieChart(enteric, housing, storage) {
            const total = enteric + housing + storage;
            const entericPercent = (enteric / total * 100).toFixed(0);
            const housingPercent = (housing / total * 100).toFixed(0);
            const storagePercent = (storage / total * 100).toFixed(0);
            
            document.getElementById('entericPercent').textContent = entericPercent;
            document.getElementById('housingPercent').textContent = housingPercent;
            document.getElementById('storagePercent').textContent = storagePercent;
            
            const canvas = document.getElementById('pieCanvas');
            const ctx = canvas.getContext('2d');
            const centerX = 100;
            const centerY = 100;
            const radius = 80;
            
            ctx.clearRect(0, 0, 200, 200);
            
            let startAngle = 0;
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1'];
            const values = [enteric, housing, storage];
            
            values.forEach((value, index) => {
                const sliceAngle = (value / total) * 2 * Math.PI;
                
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngle, startAngle + sliceAngle);
                ctx.closePath();
                ctx.fillStyle = colors[index];
                ctx.fill();
                ctx.strokeStyle = 'white';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                startAngle += sliceAngle;
            });
        }

        // ç»˜åˆ¶æŸ±çŠ¶å›¾
        function drawBarChart(ch4, nh3, n2o) {
            const maxValue = Math.max(ch4, nh3, n2o);
            const container = document.getElementById('gasBarChart');
            
            const data = [
                { label: 'CHâ‚„', value: ch4 },
                { label: 'NHâ‚ƒ', value: nh3 },
                { label: 'Nâ‚‚O', value: n2o }
            ];
            
            container.innerHTML = data.map(item => {
                const height = (item.value / maxValue * 200).toFixed(0);
                return `
                    <div class="bar-item">
                        <div class="bar" style="height: ${height}px;">
                            <div class="bar-value">${item.value.toFixed(0)}</div>
                        </div>
                        <div class="bar-label">${item.label}</div>
                    </div>
                `;
            }).join('');
        }

        // ç»˜åˆ¶å¯¹æ¯”å›¾
        function drawComparisonChart(currentCH4) {
            const container = document.getElementById('comparisonChart');
            const baseline = currentCH4;
            
            const data = [
                { label: 'å½“å‰æ–¹æ¡ˆ', value: baseline, percent: 100 },
                { label: 'åŒæ°§å‘é…µ', value: baseline * 0.8, percent: 80 },
                { label: 'å †è‚¥å¤„ç†', value: baseline * 0.4, percent: 40 },
                { label: 'ç›´æ¥è¿˜ç”°', value: baseline * 0.2, percent: 20 }
            ];
            
            container.innerHTML = data.map(item => `
                <div class="comparison-row">
                    <div class="comparison-label">${item.label}</div>
                    <div class="comparison-bar-container">
                        <div class="comparison-bar" style="width: ${item.percent}%">
                            ${item.value.toFixed(0)} kg
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ç»˜åˆ¶æ•£ç‚¹å›¾
        function drawScatterChart(nue, ch4Intensity) {
            const canvas = document.getElementById('scatterCanvas');
            canvas.innerHTML = '<div class="axis-label x-axis-label">æ°®åˆ©ç”¨æ•ˆç‡ (%)</div><div class="axis-label y-axis-label">CHâ‚„æ’æ”¾å¼ºåº¦ (kg/kgäº§å“)</div>';
            
            // æ¨¡æ‹Ÿä¸€äº›æ•°æ®ç‚¹
            const points = [
                { nue: nue, ch4: ch4Intensity }
            ];
            
            // æ·»åŠ å‚è€ƒç‚¹
            for (let i = 0; i < 20; i++) {
                points.push({
                    nue: 15 + Math.random() * 25,
                    ch4: 15 + Math.random() * 35
                });
            }
            
            points.forEach((point, index) => {
                const x = (point.nue / 40 * 100);
                const y = (100 - point.ch4 / 50 * 100);
                const dot = document.createElement('div');
                dot.className = 'scatter-point';
                dot.style.left = x + '%';
                dot.style.bottom = y + '%';
                if (index === 0) {
                    dot.style.background = '#FF6B6B';
                    dot.style.width = '12px';
                    dot.style.height = '12px';
                }
                canvas.appendChild(dot);
            });
        }

        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œåˆå§‹è®¡ç®—
        window.onload = function() {
            calculate();
        };
    </script>
</body>
</html>
